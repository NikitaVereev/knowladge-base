---
title: 01 Введение и Архитектура
---

---

## Проблема Ручного Управления

```
100 серверов, нужно установить Nginx:

❌ Вариант 1: Ручной
for i in 1..100; do
  ssh ubuntu@server$i "sudo apt update && sudo apt install nginx"
done
→ 2 часа, ошибки, скучно

✓ Вариант 2: Ansible
ansible-playbook -i hosts.ini nginx.yml
→ 5 минут, повторяемо, с логами
```

---

## Infrastructure as Code

**Конфигурация как код:**
```yaml
---
- hosts: webservers
  tasks:
    - apt: name=nginx state=present
    - systemd: name=nginx state=started
```

**Преимущества:**
- Версионирование в Git
- Code review перед развертыванием
- История всех изменений
- Документирует текущее состояние

---

## Ansible vs Альтернативы

| Критерий | Ansible | Chef | Puppet | Terraform |
|----------|---------|------|--------|-----------|
| Язык | YAML | Ruby | DSL | HCL |
| Агент нужен | ✗ | ✓ | ✓ | ✗ |
| Сложность обучения | Легко | Сложно | Средне | Средне |
| Конфигурация серверов | ✓✓ | ✓ | ✓ | ✗ |
| Создание инфраструктуры | ✓ | ✓ | ✓ | ✓✓ |
| Скорость развертывания | Быстро | Медленно | Медленно | Быстро |

**Итог:**
- **Ansible:** конфигурация + небольшие облака
- **Terraform:** создание облачных ресурсов
- **Chef/Puppet:** большие enterprise решения

---

## Архитектура Ansible

```
┌─────────────────────────────────────────────────┐
│        Control Node                             │
│  (Ваш ноутбук / сервер управления)             │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Ansible (Python)                        │   │
│  │ Playbooks (YAML)                        │   │
│  │ Inventory (hosts.ini)                   │   │
│  └─────────────────────────────────────────┘   │
│           ↓ SSH подключение ↓                   │
└─────────────────────────────────────────────────┘
        ↙           ↓           ↘
┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│  Server 1   │ │  Server 2   │ │  Server N   │
│             │ │             │ │             │
│ Python 3.9+ │ │ Python 3.9+ │ │ Python 3.9+ │
│ SSH Server  │ │ SSH Server  │ │ SSH Server  │
└─────────────┘ └─────────────┘ └─────────────┘
```

---

## Жизненный Цикл Playbook

```
1. ПАРСИНГ
   └─ Чтение ansible.cfg
   └─ Загрузка инвентаря
   └─ Парсинг playbook.yml

2. ПОДГОТОВКА
   └─ Для каждого хоста:
      ├─ SSH подключение
      └─ Сбор фактов (OS, Python version, etc)

3. ВЫПОЛНЕНИЕ
   └─ pre_tasks
   └─ tasks
      └─ Для каждой задачи:
         ├─ Проверить условия (when)
         ├─ Запустить модуль
         ├─ Получить результат (changed: true/false)
         └─ Вызвать handlers если нужно
   └─ post_tasks

4. ОТЧЕТ
   └─ Вывести результаты
   └─ Показать what changed
```

---

## Как Ansible Работает

**Пример выполнения:**

```
Ansible отправляет SSH команду:
$ ssh ubuntu@server "python3 -m ansible.modules.apt \
  '{\"name\": \"nginx\", \"state\": \"present\"}'"

На сервере:
1. Python загружает модуль apt
2. Модуль проверяет: nginx установлен?
3. Если нет → установить → вернуть changed: true
4. Если да → пропустить → вернуть changed: false
```

---

## Идемпотентность

**Ключевая концепция - безопасно повторять:**

```
Запуск 1: nginx не установлен
→ Модуль apt: установить
→ Результат: changed: true

Запуск 2: nginx уже установлен
→ Модуль apt: уже есть, пропускаем
→ Результат: changed: false

Запуск 3: nginx всё ещё установлен
→ Модуль apt: уже есть, пропускаем
→ Результат: changed: false
```

**Вывод:** Можешь запускать playbook 100 раз, результат будет одинаков!

---

## Требования

**На Control Node:**
- Python 3.12+
- pip (для установки Ansible)
- SSH клиент
- Доступ в интернет (для скачивания пакетов)

**На Managed Nodes:**
- Python 3.9+ (или Python 2.7 для старых систем)
- SSH сервер на порту 22
- Пользователь для подключения (любой)
- Доступ по SSH по ключам или паролю

**Сеть:**
- SSH доступ с control node до всех managed nodes
- Обычно это просто SSH на 22 порт

---

## Преимущества Ansible

✓ **Agentless:** не нужно устанавливать ничего на серверы  
✓ **SSH:** используется везде по умолчанию  
✓ **YAML:** просто читается, похоже на документацию  
✓ **Идемпотентность:** безопасно повторять многократно  
✓ **Push:** управление с одной центральной машины  
✓ **Python:** модули легко писать и расширять  

---

## Когда Использовать Ansible

✓ **Хорошо для:**
- Установка и конфигурация ПО
- Управление конфигурациями серверов
- Развертывание приложений
- Автоматизация рутинных задач
- Системные обновления

✗ **Не подходит для:**
- Создание облачных ресурсов (используй Terraform)
- Мониторинг в реальном времени (используй Prometheus)
- Управление БД с миграциями (используй Liquibase)

---

**Следующее:** [[02-installation|Установка и Конфигурация]]
