---
title: 04 –û–±—Ä–∞–∑—ã –∏ Dockerfile
---

–°–æ–∑–¥–∞–Ω–∏–µ, —Å–±–æ—Ä–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–æ–≤.

---

#### üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

##### **[[01-images-layers]]**

**–ß—Ç–æ —Ç–∞–∫–æ–µ Docker Image:**
- –û–±—Ä–∞–∑ –∫–∞–∫ —à–∞–±–ª–æ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
- –°–ª–æ–∏ (layers) –∏ –∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- Immutable (–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ) —Å–ª–æ–∏
- Layer Identifier –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–æ–µ–≤:**
- –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ (base image)
- Writable layer –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- Overlay File System –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Å–ª–æ—ë–≤

**–≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞:**
- –û–±—â–∏–µ —Å–ª–æ–∏ –º–µ–∂–¥—É –æ–±—Ä–∞–∑–∞–º–∏
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤
- –ö–æ–º–∞–Ω–¥—ã `docker save`, `docker load`

**–†–∞–±–æ—Ç–∞ —Å –æ–±—Ä–∞–∑–∞–º–∏:**
- `docker pull` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–∞
- `docker image ls` ‚Äî —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞–∑–æ–≤
- `docker history` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Å–ª–æ—ë–≤
- `docker inspect` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ü—Ä–∏–º–µ—Ä—ã:**
- –ê–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–∞ Nginx (6 —Å–ª–æ—ë–≤)
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã Docker –æ–±—Ä–∞–∑—ã.

---

##### **[[02-dockerfile-basics]]**

**–í–≤–µ–¥–µ–Ω–∏–µ –≤ Dockerfile:**
- Dockerfile –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –∫–æ–º–∞–Ω–¥–æ–π `docker build`
- –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ –∏ `.dockerignore`

**–û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ Dockerfile:**
- `FROM` ‚Äî –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–≤—ã–º)
- `WORKDIR` ‚Äî —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
- `COPY` / `ADD` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- `RUN` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- `ENV` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `EXPOSE` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
- `USER` ‚Äî —Å–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `LABEL` ‚Äî –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
- `CMD` ‚Äî –∫–æ–º–∞–Ω–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `ENTRYPOINT` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- –†–∞–∑–ª–∏—á–∏—è –∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ CMD –∏ ENTRYPOINT

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã –ø—Ä–∏ —Å–±–æ—Ä–∫–µ:**
- `ARG` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏
- `docker build --build-arg VAR=value`

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã:**
- Dockerfile –¥–ª—è Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- Dockerfile –¥–ª—è Python –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Alpine –æ–±—Ä–∞–∑–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–º–µ–Ω–∏–µ –ø–∏—Å–∞—Ç—å Dockerfile –¥–ª—è —Å–≤–æ–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

---

##### **[[03-build-optimize]]**

**–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ —Å–±–æ—Ä–∫–µ:**
- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ (1.2+ –ì–ë –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –°–ª–æ–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤–µ—Å—å build
- –†–µ—à–µ–Ω–∏–µ: –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –î–û –∫–æ–¥–∞
  - –°–Ω–∞—á–∞–ª–∞ `COPY package*.json`
  - –ó–∞—Ç–µ–º `RUN npm install`
  - –ü–æ—Ç–æ–º `COPY . .`

**–í—ã–±–æ—Ä –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞:**
- Alpine Linux (~5 –ú–ë) vs Ubuntu (~77 –ú–ë) vs Debian (~114 –ú–ë)
- Node:14 (882 –ú–ë) vs Node:14-alpine (150 –ú–ë)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1.2 –ì–ë ‚Üí 467 –ú–ë

**Multi-stage build (–º—É–ª—å—Ç–∏—Å—Ç–µ–π–¥–∂):**
- Stage 1: –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å–æ –≤—Å–µ–º–∏ dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏)
- Stage 2: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ (—Ç–æ–ª—å–∫–æ runtime)
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ stage 1
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 472 –ú–ë ‚Üí 330 –ú–ë –∏–ª–∏ –¥–∞–∂–µ –º–µ–Ω—å—à–µ

**–ê–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–∞ (Dive tool):**
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Dive
- –ê–Ω–∞–ª–∏–∑ —Å–ª–æ—ë–≤: `dive image_name`
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- –í—ã—è–≤–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –º–µ—Å—Ç–∞

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã:**
- Node.js + Multi-stage build
- Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å Scratch –±–∞–∑–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º (6.13 –ú–ë!)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤

**Best practices:**
- –ò—Å–ø–æ–ª—å–∑—É–π Alpine –æ–±—Ä–∞–∑—ã
- –ì—Ä—É–ø–ø–∏—Ä—É–π RUN –∫–æ–º–∞–Ω–¥—ã —Å `&&`
- –ò—Å–ø–æ–ª—å–∑—É–π `.dockerignore`
- Multi-stage –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—Ä–∞–∑—ã –º–µ–Ω—å—à–µ –∏ –±—ã—Å—Ç—Ä–µ–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è.

---

#### ‚úÖ Checklist

**–ü–æ—Å–ª–µ [[01-images-layers]]:**
- ‚úÖ –ü–æ–Ω–∏–º–∞–µ—à—å –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã Docker –æ–±—Ä–∞–∑—ã
- ‚úÖ –ó–Ω–∞–µ—à—å —á—Ç–æ —Ç–∞–∫–æ–µ —Å–ª–æ–∏
- ‚úÖ –ú–æ–∂–µ—à—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–ª–æ—ë–≤ –æ–±—Ä–∞–∑–∞

**–ü–æ—Å–ª–µ [[02-dockerfile-basics]]:**
- ‚úÖ –ú–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π Dockerfile
- ‚úÖ –ó–Ω–∞–µ—à—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (FROM, RUN, COPY, CMD)
- ‚úÖ –†–∞–∑–ª–∏—á–∞–µ—à—å CMD –∏ ENTRYPOINT

**–ü–æ—Å–ª–µ [[03-build-optimize]]:**
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—à—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—à—å multi-stage build
- ‚úÖ –£–º–µ–Ω—å—à–∞–µ—à—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–æ–≤
- ‚úÖ –ú–æ–∂–µ—à—å –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã Dive —É—Ç–∏–ª–∏—Ç–æ–π

---

#### üîó –°–≤—è–∑–∏

**–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–∞–∑–¥–µ–ª:**
- [[docs/02-docker-ansible/03-docker-basics/index|index]] ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

%% **–°–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã:**
- [[05-docker-networks]] ‚Äî —Å–µ—Ç–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
- [[06-docker-volumes]] ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- [[07-docker-compose]] ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
- [[08-docker-registry]] ‚Äî Docker Registry –∏ —Ä–µ–µ—Å—Ç—Ä—ã %%

---
