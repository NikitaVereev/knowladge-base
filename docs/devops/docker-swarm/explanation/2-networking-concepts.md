---
title: "2 Сетевая магия Swarm (Ingress & Overlay)"
description: "Глубокое погружение в Service Discovery, Virtual IP (VIP) и Routing Mesh."
---

Сетевой стек Swarm позволяет сервисам общаться друг с другом прозрачно, даже если они находятся на разных континентах.

## Overlay Network (Оверлейная сеть)

Это виртуальная сеть (L2 over L3), построенная поверх физической сети хостов.
*   Использует технологию **VXLAN**.
*   Может быть **зашифрована** (IPSec) одной опцией `--opt encrypted`.
*   Контейнеры видят друг друга по внутренним IP, независимо от того, на каком хосте они запущены.

## Service Discovery и DNS

В Swarm встроен свой DNS-сервер (обычно `127.0.0.11`).

Когда контейнер `frontend` хочет обратиться к `backend`:
1.  Он делает DNS-запрос `backend`.
2.  Swarm возвращает **Virtual IP (VIP)** сервиса (не IP конкретного контейнера!).
3.  Ядро Linux (через IPVS) перехватывает пакеты на этот VIP и балансирует их между реальными IP контейнеров.

Это называется **VIP-based load balancing**.

## Ingress Routing Mesh

Позволяет опубликовать порт на весь кластер.
*   Если вы публикуете порт 80, он открывается на **всех** нодах кластера.
*   Запрос на `Node-1:80` будет перенаправлен на нужный контейнер, даже если он запущен на `Node-3`.
*   Это обеспечивает отказоустойчивость: вы можете направить балансировщик нагрузки на любые ноды кластера.

## Связанные материалы
- [[docs/devops/docker-swarm/explanation/1-architecture|Архитектура Swarm]]
- [[devops/docker/explanation/docker-networks|Основы сетей Docker]]
