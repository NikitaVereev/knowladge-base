---
title: "1 Архитектура Docker Swarm"
description: "Как устроен кластер: роли нод (Managers vs Workers), алгоритм консенсуса Raft и понятие кворума."
---

Docker Swarm превращает группу хостов Docker в единый виртуальный движок.

## Роли узлов (Node Roles)

В кластере есть два типа нод:

### 1. Managers (Управляющие)
Мозг кластера. Они отвечают за:
*   **Orchestration:** Распределение задач (контейнеров) по нодам.
*   **Cluster State:** Хранение конфигурации кластера и секретов.
*   **Dispatching:** Отправка команд воркерам.

Менеджеры используют алгоритм **Raft Consensus** для синхронизации данных. Среди менеджеров всегда есть один **Leader**, который принимает записи. Остальные — Followers.

### 2. Workers (Рабочие)
Мускулы кластера. Их задача:
*   Получать задачи (Tasks) от менеджеров.
*   Запускать контейнеры.
*   Сообщать статус обратно (Running, Failed).

*Примечание: По умолчанию менеджеры также являются воркерами (могут запускать контейнеры), но в продакшене их часто изолируют (Drain mode).*

## Кворум и Отказоустойчивость

Для работы кластера (возможности вносить изменения) требуется **кворум** — согласие большинства менеджеров. Формула: `(N / 2) + 1`.

| Всего менеджеров | Кворум | Допустимые падения |
| :--- | :--- | :--- |
| 1 | 1 | 0 |
| 3 | 2 | 1 |
| 5 | 3 | 2 |
| 7 | 4 | 3 |

**Почему нечетное число?** Добавление 4-го менеджера не увеличивает отказоустойчивость (все еще можно потерять только 1), но увеличивает нагрузку на сеть при репликации данных.

## Жизненный цикл сервиса

1.  Вы отправляете команду `docker service create`.
2.  API передает запрос Лидеру.
3.  **Orchestrator** создает объект Service.
4.  **Scheduler** разбивает сервис на Tasks (задачи/реплики).
5.  **Allocator** выдает IP-адреса задачам.
6.  **Dispatcher** назначает задачи конкретным нодам.
7.  Воркер получает задачу и запускает контейнер.

## Связанные материалы
- [[2-networking-concepts|Сетевая архитектура и Service Discovery]]
- [[2-best-practices|Лучшие практики эксплуатации]]
