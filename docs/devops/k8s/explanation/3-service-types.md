---
title: 3 Типы сервисов в Kubernetes
type: explanation
tags: [kubernetes, networking, service, clusterip, nodeport, loadbalancer]
---

Поды в Kubernetes эфемерны: они умирают и перерождаются, меняя свои IP-адреса. Чтобы другие приложения могли стабильно общаться с вашим приложением, используется абстракция **Service**.

Service — это постоянный "фасад" (stable endpoint), который знает актуальные IP-адреса подов и балансирует трафик между ними.

---

## 1. ClusterIP (Стандартный)
**"Только для своих."**

Это тип сервиса по умолчанию. Он выделяет виртуальный IP-адрес, который доступен **только изнутри кластера**.

### Сценарий использования
*   Взаимодействие микросервисов друг с другом (Frontend -> Backend).
*   Подключение к базе данных внутри кластера.
*   Отладка и безопасность (никто извне не подключится).

### Схема
```text
[Pod A] --(внутренний трафик)--> [Service: ClusterIP] --> [Pod B (Backend)]
```

---

## 2. NodePort
**"Дырка в заборе."**

Открывает определенный порт (по умолчанию из диапазона 30000-32767) на **каждом** узле кластера (Node). Любой трафик, пришедший на этот порт любого узла, перенаправляется в сервис.

### Сценарий использования
*   Быстрый доступ к приложению во время разработки (Minikube).
*   Когда нет возможности использовать LoadBalancer (on-premise без облака).

### Схема
```text
User --> [Node IP]:30007 --> [Service] --> [Pod]
```
> **Недостаток:** Вы вынуждены знать IP-адреса ваших нод. Если нода упадет, IP сменится. Это "сырой" способ публикации.

---

## 3. LoadBalancer
**"Облачный стандарт."**

Использует API облачного провайдера (AWS, Google Cloud, Azure) для создания настоящего внешнего балансировщика нагрузки. Провижинит внешний белый IP-адрес.

### Сценарий использования
*   Публикация production-приложений в облаке.
*   Единая точка входа с "красивым" IP.

### Схема
```text
User --> [AWS ELB / Google LB] --> [NodePort] --> [Service] --> [Pod]
```
> **Важно:** LoadBalancer по сути создает NodePort и настраивает облачный балансировщик, чтобы тот слал трафик на эти нод-порты.

---

## 4. Headless Service (Безголовый)
**"Прямой контакт."**

Специальный вид ClusterIP, где `ClusterIP: None`. У такого сервиса **нет виртуального IP**. Вместо балансировки он возвращает через DNS список IP-адресов **всех** связанных подов.

### Сценарий использования
*   **Stateful-приложения:** Базы данных (Mongo, Postgres, Cassandra), где узлам важно знать друг друга "в лицо" для репликации.
*   Собственная балансировка на стороне клиента (Client-side load balancing).

### Сравнение
*   **Обычный Service:** DNS отдает 1 IP сервиса. Трафик идет через iptables/IPVS.
*   **Headless Service:** DNS отдает 3 IP (всех реплик). Клиент сам выбирает, к кому коннектиться.

---

## Сводная таблица

| Тип | Доступность | IP-адрес | Для чего нужен |
| :--- | :--- | :--- | :--- |
| **ClusterIP** | Внутри кластера | Виртуальный внутренний | Backend, DB, внутренние API |
| **NodePort** | Извне (по IP ноды) | IP ноды + Порт (3xxxx) | Тесты, On-premise |
| **LoadBalancer** | Извне (публичный IP) | Публичный белый | Production в облаке |
| **Headless** | Внутри кластера | Нет (прямые IP подов) | Базы данных, StatefulSets |

## Что такое Ingress?
Часто возникает путаница: *Ingress — это не тип сервиса*.
Ingress — это "умный маршрутизатор" (Nginx, Traefik), который стоит на входе в кластер (обычно за LoadBalancer) и раскидывает HTTP-трафик по разным ClusterIP сервисам на основе доменов (`api.site.com`, `blog.site.com`). О нем мы поговорим отдельно.
