---
title: "5 Стратегия версионирования"
description: "SemVer, Git SHA и почему использование тега latest в продакшене — это антипаттерн."
---

Правильное версионирование образов — залог предсказуемости ваших релизов.

## 1. Антипаттерн "Latest"
Тег `latest` — это просто строка (текст), которая не имеет никакой магии. Она **не означает** "самая новая версия". Она означает "версия по умолчанию, если пользователь не указал другую".

**Почему это опасно:**
1.  **Непредсказуемость:** Сегодня `node:latest` — это Node 20. Завтра вы пересобрали проект, и это уже Node 21. Ваш код сломался.
2.  **Отсутствие истории:** Вы не знаете, какая версия кода сейчас работает на продакшене, если везде написано `latest`.
3.  **Кэширование:** Kubernetes/Docker часто кэшируют теги. Если вы обновили `myapp:latest` в реестре, сервер может продолжать запускать старую версию из кэша.

## 2. Стратегии тегирования

### SemVer (Semantic Versioning) — Для релизов
Используйте формат `vMAJOR.MINOR.PATCH`.
*   `v1.0.0`: Стабильный релиз.
*   `v1.0.1`: Патч (багфикс).
*   `v2.0.0`: Ломающие изменения.

При публикации образа хорошей практикой считается вешать несколько тегов ("Floating Tags"):
```bash
docker build -t myapp:1.2.3 .
docker tag myapp:1.2.3 myapp:1.2
docker tag myapp:1.2.3 myapp:1
```
Это позволяет пользователям пиниться на мажорную версию (`myapp:1`), получая фиксы безопасности, но избегая ломающих изменений.

### Git Commit SHA — Для CI/CD
Для каждого коммита в ветку (dev/feature) создавайте образ с тегом, равным хешу коммита.
*   Пример: `myapp:a1b2c3d`
*   **Плюс:** Вы точно знаете, из какого кода собран этот образ.
*   **Плюс:** Иммутабельность. Хеш коммита уникален.

## 3. Pinning (Пининг) версий

### В Dockerfile (Base Image)
Всегда фиксируйте версию базового образа.

*   **Плохо:** `FROM node`
*   **Хорошо:** `FROM node:20.10.0-alpine` (Конкретная версия)
*   **Идеально (Paranoid Mode):** Пининг по **digest** (SHA256 хешу содержимого).
    ```dockerfile
    FROM node@sha256:4c2a...
    ```
    Это гарантирует, что образ будет байт-в-байт одинаковым даже через 5 лет, даже если хакеры взломают Docker Hub и подменят тег `20.10.0`.
