---
title: 4 Best Practices Checklist
description: Чек-лист для Code Review. Безопасность, оптимизация Dockerfile и принципы 12-Factor App.
---

## 1. Dockerfile & Сборка

- [ ] **Используйте конкретные теги.**
    *   *Bad*: `FROM node:latest` (непредсказуемо).
    *   *Good*: `FROM node:20.9-alpine` (стабильно).
- [ ] **Multi-stage builds.**
    *   Не тяните компиляторы (Go, gcc) и `node_modules` с dev-зависимостями в прод-образ.
- [ ] **.dockerignore обязателен.**
    *   Исключите `.git`, `node_modules`, локальные `.env` файлы.
- [ ] **Правильный порядок слоев.**
    *   Сначала копируем `package.json` -> `RUN install` -> Потом копируем код. Это ускоряет сборку (кеш).
- [ ] **Минимизация слоев.**
    *   Объединяйте `RUN apt-get update && apt-get install ... && rm -rf /var/lib/apt/lists/*` в одну строку.
- [ ] **Не используйте Root.**
    *   Добавьте `USER node` или создайте своего пользователя. Root в контейнере = Root на хосте (потенциально).

## 2. Runtime & Конфигурация

- [ ] **Один процесс на контейнер.**
    *   Не используйте supervisor/monit, если это не обосновано жесткой необходимостью.
- [ ] **Никаких IP-адресов.**
    *   Используйте DNS-имена сервисов (`db`, `redis`) внутри сети Docker.
- [ ] **Graceful Shutdown.**
    *   Приложение должно ловить `SIGTERM` и корректно закрываться. Используйте `exec` форму в ENTRYPOINT.
- [ ] **Конфиг через ENV.**
    *   Не зашивайте `DB_PASSWORD` в Dockerfile. Используйте переменные окружения.
- [ ] **Healthchecks.**
    *   Всегда добавляйте `HEALTHCHECK` в Dockerfile или compose.yaml, чтобы оркестратор знал, живо ли приложение.
- [ ] **Лимиты ресурсов.**
    *   Всегда задавайте `mem_limit` и `cpus` в продакшене, чтобы избежать OOM всей ноды.

## 3. Безопасность

- [ ] **Read-Only Root FS.**
    *   По возможности запускайте с `--read-only`. Пишите только в `/tmp` (tmpfs) или Volumes.
- [ ] **Не монтируйте Docker Socket.**
    *   Избегайте `-v /var/run/docker.sock:/var/run/docker.sock` — это дает контейнеру полные права root на хосте.
- [ ] **Сканирование образов.**
    *   Используйте `trivy` или `docker scan` перед деплоем.

## 4. Логирование

- [ ] **Логи только в STDOUT/STDERR.**
    *   Не пишите в файлы внутри контейнера. Пусть Docker собирает логи из потока вывода.
- [ ] **JSON формат (опционально).**
    *   Для удобства парсинга в ELK/Graylog пишите логи в JSON-формате, а не текстом.
