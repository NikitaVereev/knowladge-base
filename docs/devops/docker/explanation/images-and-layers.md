---
title: "Образы и слои Docker"
description: "Как устроены Docker образы: слоистая архитектура, Union File System и механизм Copy-on-Write."
---


Docker образ (Image) — это шаблон "только для чтения", из которого создаются контейнеры. Главная особенность образов — их слоистая структура.

## Архитектура слоев

Вместо того чтобы хранить полную копию операционной системы для каждого приложения, Docker использует **Union File System (OverlayFS)**. Образ состоит из набора неизменяемых слоев, наложенных друг на друга.

### Визуализация стека

Когда вы запускаете контейнер, Docker добавляет поверх слоев образа новый, тонкий слой для записи (**Writable Container Layer**).

```text
┌──────────────────────────────┐
│  Writable Layer (RW)         │  <-- Контейнер (здесь хранятся изменения)
├──────────────────────────────┤
│  Application Code (RO)       │  <-- Слой образа
├──────────────────────────────┤
│  Runtime / Libraries (RO)    │  <-- Слой образа
├──────────────────────────────┤
│  Base OS (Alpine/Debian) (RO)│  <-- Слой образа
└──────────────────────────────┘
   (RO) = Read Only
```

### Принцип Copy-on-Write (CoW)
Если контейнеру нужно изменить файл, который находится в нижнем (read-only) слое:
1. Docker ищет файл в слоях снизу вверх.
2. Копирует файл в верхний Writable Layer.
3. Вносит изменения в эту копию.
4. Оригинал в нижнем слое остается нетронутым (и доступным для других контейнеров).

## Эффективность хранения

Благодаря слоям, Docker экономит место на диске.
* Если у вас 10 контейнеров на базе `nginx:latest`, на диске хранится **только одна копия** образа Nginx (примерно 150 МБ).
* Каждый контейнер занимает место только под свои уникальные изменения (обычно килобайты).

## Исследование слоев

Вы можете увидеть историю слоев любого образа командой `docker history`:

```bash
docker history nginx:latest
```

**Пример вывода:**
```text
IMAGE          CREATED      CREATED BY                                      SIZE
<missing>      2 weeks ago  /bin/sh -c #(nop)  CMD ["nginx" "-g" "daem...   0B
<missing>      2 weeks ago  /bin/sh -c #(nop)  EXPOSE 80                    0B
...
<missing>      2 weeks ago  /bin/sh -c apt-get install -y nginx             50MB
```
*Заметьте, что команды вроде `CMD` или `EXPOSE` создают слои нулевого размера (metadata).*

## Связанные материалы

- [[devops/docker/how-to/manage-images|Управление образами (команды)]]
- [[devops/docker/tutorials/dockerfile-basics|Создание своих образов (Dockerfile)]]
