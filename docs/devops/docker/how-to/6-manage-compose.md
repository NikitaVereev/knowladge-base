---
title: "6 Управление через Compose"
description: "Шпаргалка по командам Compose V2, управление профилями, масштабирование (Scaling) и логи."
---

В современных версиях Docker (V2) команда `docker-compose` (с дефисом) считается устаревшей. Новый стандарт — `docker compose` (с пробелом), встроенный в основной CLI.

## Повседневные команды

### Запуск и Остановка

| Команда | Описание |
| :--- | :--- |
| `docker compose up -d` | Поднять проект в фоне (Detached). Если конфиг изменился — пересоздаст только затронутые сервисы. |
| `docker compose up --build -d` | Принудительно пересобрать образы перед запуском (полезно при изменении кода). |
| `docker compose down` | Остановить и **удалить** контейнеры и сети. Данные в volumes **сохраняются**. |
| `docker compose down -v` | **ОПАСНО!** Удаляет контейнеры, сети и **все тома (volumes)** с данными. |
| `docker compose stop` | Просто остановить контейнеры (без удаления). Можно потом сделать `start`. |

### Мониторинг и Логи

| Команда | Описание |
| :--- | :--- |
| `docker compose ps` | Показать список запущенных контейнеров и их статус. |
| `docker compose logs -f` | Читать логи всех сервисов "хвостом" (follow) в реальном времени. |
| `docker compose logs -f db` | Читать логи только конкретного сервиса (например, `db`). |
| `docker compose top` | Показать активные процессы (PID) внутри контейнеров. |

### Работа с сервисами

*   **Зайти в контейнер:**
    ```bash
    docker compose exec web bash  # Если bash нет, используйте sh
    ```
*   **Перезапустить один сервис:**
    ```bash
    docker compose restart worker
    ```
*   **Выполнить разовую команду:**
    ```bash
    docker compose run --rm web npm test
    ```
    *`run` запускает новый отдельный контейнер для команды, `--rm` удаляет его после завершения.*

## Масштабирование (Scaling)

Docker Compose умеет запускать несколько копий одного сервиса. Это полезно для проверки stateless-приложений или воркеров очередей.

```bash
docker compose up -d --scale worker=3
```
*Теперь у вас будет 3 контейнера `worker`.*

> **Важно про порты:** Если сервис пробрасывает порт (например, `-p 80:80`), вы **не сможете** его масштабировать (ошибка "Port is already allocated").
> *Решение:* Уберите `ports` из масштабируемого сервиса и поставьте перед ними балансировщик (Nginx/Traefik/HAProxy), который будет распределять трафик внутри Docker-сети.

## Управление Профилями (Profiles)

Если в `compose.yaml` используются профили (например, `profiles: ["debug"]`), обычный `docker compose up` их проигнорирует.

*   **Запуск с профилем:**
    ```bash
    docker compose --profile debug up -d
    ```
*   **Остановка всего (включая профили):**
    Иногда `down` не видит сервисы из профилей и оставляет их висеть.
    ```bash
    docker compose --profile "*" down
    ```
