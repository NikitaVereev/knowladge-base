---
title: "5 Управление сетями"
description: "Руководство по созданию пользовательских сетей, подключению контейнеров и диагностике DNS."
---

В Docker сеть — это первый рубеж безопасности и основа взаимодействия микросервисов. Правильная настройка сетей позволяет контейнерам общаться по DNS-именам, не выставляя порты наружу.

## Основные операции

### 1. Создание сети
Никогда не используйте дефолтную сеть (`bridge`) для продакшена, так как в ней не работает DNS. Создавайте свои сети:
```bash
docker network create app-net
```

### 2. Запуск контейнеров в сети
```bash
# База данных: доступна только внутри сети app-net
docker run -d --name mongo --network app-net mongo

# Веб-приложение: доступно снаружи (порт 80) и видит mongo внутри
docker run -d --name web --network app-net -p 80:80 my-web-app
```
Теперь приложение `web` может обращаться к базе по строке подключения: `mongodb://mongo:27017`.

### 3. Подключение на лету
Вы можете подключить работающий контейнер к новой сети без перезагрузки:
```bash
docker network connect app-net existing_container
```
*Контейнер может быть подключен сразу к нескольким сетям (Multi-homing).*

## Проброс портов vs Внутренняя связь

Частая ошибка новичков — пробрасывать порты (`-p`) для всего подряд.

| Сценарий | Настройка | Доступность |
| :--- | :--- | :--- |
| **Публичный API / Frontend** | `-p 80:80` | Доступен из Интернета и локальной сети. |
| **База данных / Redis / Backend** | **Без флага `-p`** | Доступен **только** другим контейнерам в той же сети. |

> **Dockerfile `EXPOSE`**: Инструкция `EXPOSE 80` в Dockerfile — это **просто документация**. Она сама по себе ничего не открывает и не пробрасывает.

## Диагностика (DNS и связь)

Если контейнеры "не видят" друг друга:

1.  **Проверка DNS (через временный контейнер):**
    Запустите утилиту `dig` или `nslookup` в той же сети:
    ```bash
    docker run --rm --network app-net alpine nslookup mongo
    ```
    *Должен вернуться внутренний IP, например `172.18.0.2`.*

2.  **Проверка изоляции:**
    Убедитесь, что оба контейнера находятся в одной сети:
    ```bash
    docker network inspect app-net
    ```
    *В секции "Containers" должны быть оба ваших сервиса.*

3.  **Внутренний резолвер Docker:**
    Docker использует встроенный DNS-сервер по адресу `127.0.0.11`. Если у вас проблемы с DNS внутри контейнера, проверьте `/etc/resolv.conf` внутри него.
