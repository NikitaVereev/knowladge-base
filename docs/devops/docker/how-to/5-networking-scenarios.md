---
title: 5 Сетевые сценарии
description: Решение типовых задач - связь между контейнерами по DNS, доступ к localhost хоста (host.docker.internal) и безопасная публикация портов.
---

## 1. Связь между контейнерами (DNS)

Никогда не используйте IP-адреса для общения контейнеров. Используйте имена сервисов.

### Шаг 1. Создать сеть
```bash
docker network create my-app-net
```

### Шаг 2. Запустить контейнеры в этой сети
```bash
# Бэкенд (Имя контейнера = DNS имя)
docker run -d --name db --network my-app-net postgres

# Фронтенд
docker run -d --name web --network my-app-net nginx
```

### Шаг 3. Проверка
Теперь из `web` можно пинговать `db`.
```bash
docker exec web ping db
```
В конфигах приложения указывайте хост БД просто как `db` (например: `postgres://user:pass@db:5432/mydb`).

## 2. Доступ из контейнера к Хосту
Частый кейс: приложение в докере, а база данных запущена локально на Windows/Mac/Linux (не в контейнере). `localhost` внутри контейнера — это сам контейнер, а не хост.

### Магическое имя `host.docker.internal`
Оно работает "из коробки" на Docker Desktop (Mac/Windows).

Для **Linux** нужно добавить флаг при запуске:
```bash
docker run --add-host host.docker.internal:host-gateway my-app
```
Теперь внутри контейнера можно обращаться к `http://host.docker.internal:8080`, и запрос уйдет на хост-машину.

## 3. Безопасная публикация портов

Когда вы делаете `-p 8080:80`, порт открывается на **всех** сетевых интерфейсах (`0.0.0.0`). Это значит, что ваша админка базы данных доступна всему интернету, если у вас белый IP.

### Привязка к Localhost (Loopback)
Чтобы порт был доступен *только* с самой машины (для разработки или туннелирования):

```bash
docker run -p 127.0.0.1:8080:80 nginx
```
Теперь `curl 127.0.0.1:8080` работает, а `curl внешний_ip:8080` — нет.

## 4. Подключение к сети другого контейнера (Sidecar)
Иногда нужно запустить утилиту (например, `curl` или `tcpdump`), чтобы отдебажить трафик контейнера, в котором нет shell'а (distroless).

Используйте режим `container:<id>`.
```bash
# Запускаем netshoot и "присасываемся" к сетевому стеку контейнера my-app
docker run -it --rm --net container:my-app nicolaka/netshoot
```
Теперь для вас `localhost` — это локалхост контейнера `my-app`. Вы видите его открытые порты и трафик.

## 5. Обслуживание сетей

### Очистка
Удалить все неиспользуемые сети (часто остаются после `docker compose up/down`).
```bash
docker network prune
```

### Инспекция
Посмотреть, какие IP выданы контейнерам в сети и какой там Gateway.
```bash
docker network inspect my-app-net
```
