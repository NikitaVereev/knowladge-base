---
title: "7 Отладка (Debugging)"
description: "Методика отладки контейнеров: Exit Codes (137/139), инструменты netshoot, logs и inspect."
---

Контейнеры — это "черные ящики". Когда они ломаются, важно уметь заглянуть внутрь.

## 1. Анализ "мертвых" контейнеров

Если контейнер падает сразу после запуска (`Exited`), `docker exec` не поможет (контейнер не работает).

### Смотрим логи
```bash
docker logs --tail 100 my-app
```
*   Ищите Stack Trace или сообщения об ошибках (например, "Database connection failed").
*   Если логов нет, возможно, приложение упало до того, как успело что-то вывести, или пишет не в stdout/stderr.

### Проверяем Exit Code
Код выхода расскажет правду о причине смерти.
```bash
docker inspect my-app --format='{{.State.ExitCode}}'
```

| Код | Значение | Причина |
| :--- | :--- | :--- |
| **0** | Success | Приложение завершило работу штатно (возможно, просто закончился скрипт). |
| **1** | Application Error | Ошибка в коде/конфиге. Смотрите логи. |
| **137** | **OOM Kill** (SIGKILL) | Контейнер съел больше памяти, чем ему разрешено (или чем есть на сервере). |
| **139** | Segmentation Fault | Ошибка работы с памятью (часто в бинарных библиотеках C/C++). |
| **127** | Command not found | Неверный `CMD` или `ENTRYPOINT`, либо нет нужного файла внутри. |

## 2. Анализ "живых" контейнеров

### Зайти внутрь (Exec)
```bash
docker exec -it my-app bash
# Если bash нет (Alpine), пробуйте sh
docker exec -it my-app sh
```
*Внутри проверьте:*
*   Переменные окружения: `env` (все ли пароли на месте?).
*   Конфиги: `cat /etc/myapp/config.yml` (правильно ли смонтировался файл?).
*   Сетевую связность: `ping db`.

## 3. Сетевая отладка (Sidecar Pattern)

В минимальных продакшн-образах (distroless, alpine) нет утилит `curl`, `ping`, `telnet`. Устанавливать их туда — плохая практика (мусор, риски безопасности).

Решение: Используйте **netshoot**. Это швейцарский нож сетевика (curl, nmap, dig, tcpdump, strace и др.), который можно подключить к сети вашего контейнера.

```bash
docker run -it --rm --net container:my-app nicolaka/netshoot
```
Теперь вы находитесь в консоли `netshoot`, но **видите сеть глазами контейнера `my-app`**.
*   `ss -lntp`: Слушает ли приложение порт?
*   `dig database`: Работает ли DNS?
*   `curl localhost:8080`: Отвечает ли приложение (изнутри)?
*   `tcpdump -i eth0`: Перехват трафика.

## 4. Ограничение перезапусков (CrashLoopBackOff)
Если контейнер постоянно перезагружается (`Restarting`), это забивает логи и процессор.
*   Остановите этот хаос: `docker stop my-app`.
*   Запустите его "в ручном режиме", переопределив команду запуска на бесконечный сон, чтобы он не падал:
    ```bash
    # В docker-compose.yml
    command: ["sleep", "infinity"]
    ```
    Теперь контейнер будет висеть вечно, и вы сможете зайти в него через `exec` и запустить приложение вручную, чтобы увидеть ошибку в консоли.
