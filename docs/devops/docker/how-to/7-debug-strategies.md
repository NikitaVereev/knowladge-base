---
title: 7 Методики отладки (Debugging)
description: Что делать, если контейнер падает? Алгоритм поиска неисправностей - Exit Codes, интерактивный вход, отладка сети и анализ файловой системы.
---

## Сценарий 1: Контейнер падает сразу (CrashLoopBackOff)

Контейнер запускается и тут же переходит в статус `Exited`.

**Шаг 1. Проверьте логи.**
```bash
docker logs my-app
# Или с хвостом, если логов много
docker logs --tail 50 my-app
```
*   *Что ищем*: Stacktrace приложения, сообщения "Config not found", "Connection refused".

**Шаг 2. Проверьте код выхода.**
```bash
docker inspect my-app --format='{{.State.ExitCode}}'
```
*   `0`: Приложение решило, что работа закончена (проверьте `CMD` — может быть вы запустили не сервер, а скрипт миграции?).
*   `137`: OOM (Out of Memory). Увеличьте лимит памяти.
*   `127`: Ошибка в `CMD/ENTRYPOINT` (исполняемый файл не найден).

## Сценарий 2: Контейнер висит или ведет себя странно

Приложение работает, но отвечает 500 ошибкой или тормозит.

**Шаг 1. Зайдите внутрь.**
```bash
docker exec -it my-app /bin/sh
# Если sh нет (distroless образы), этот метод не сработает.
```
Внутри проверьте:
*   `top` — не съел ли процесс 100% CPU.
*   `env` — те ли переменные окружения пришли.
*   `ls -l /app/config` — на месте ли конфиг.

**Шаг 2. Проверка сети изнутри.**
Если приложение не может достучаться до базы, попробуйте "побыть приложением".
Внутри контейнера:
```bash
# Проверка DNS
nslookup db
# Проверка порта
nc -zv db 5432
```
*Если внутри нет утилит `nslookup` или `curl` (в Alpine/Slim образах их часто нет), не ставьте их туда!*

**Решение: Sidecar-контейнер для отладки.**
Подключитесь к сети контейнера другим, "жирным" контейнером с утилитами (`nicolaka/netshoot`):
```bash
docker run -it --rm --net container:my-app nicolaka/netshoot
```
Теперь вы находитесь в том же сетевом пространстве (localhost и IP), что и `my-app`, но у вас есть `curl`, `dig`, `tcpdump`.

## Сценарий 3: "Файла нет", хотя Volume подключен

Вы примонтировали конфиг, но приложение кричит "File not found".

**Шаг 1. Проверьте Inspect.**
Посмотрите, куда реально Docker примонтировал volume.
```bash
docker inspect -f '{{ json .Mounts }}' my-app | jq
```

**Шаг 2. Проблема перекрытия (Shadowing).**
Если в образе по пути `/app/data` уже были файлы, а вы примонтировали туда **пустой** Volume, то файлы из образа **скроются**. Вы увидите пустую папку.
*   *Решение*: Копируйте данные в Entrypoint-скрипте или инициализируйте Volume заранее.
