---
title: "2 Управление контейнерами"
description: "Полное руководство: жизненный цикл, restart policies, обновление на лету и управление ресурсами (CPU/RAM)."
---

Контейнеры созданы, чтобы быть эфемерными: их должно быть легко остановить, удалить и создать заново.

## Жизненный цикл (Lifecycle)

### 1. Запуск (Run)
Команда `run` создает и сразу запускает контейнер.
```bash
docker run -d --name my-app -p 8080:80 nginx:alpine
```
*   `-d` (Detached): Фоновый режим. Без него консоль будет занята логами.
*   `--name`: Читаемое имя.
*   `-p`: Проброс портов.

### 2. Остановка и Удаление
Контейнеры бывают в состояниях `running` (работает), `exited` (остановлен) и `dead`.

*   `docker stop my-app`: Посылает сигнал **SIGTERM**. У приложения есть 10 секунд (по умолчанию), чтобы сохранить данные и корректно закрыться.
*   `docker kill my-app`: Посылает **SIGKILL**. Процесс убивается мгновенно (аналог выдергивания шнура).
*   `docker rm my-app`: Удаляет *остановленный* контейнер.
*   `docker rm -f my-app`: Force-удаление работающего контейнера (Stop + Rm).

### 3. Очистка (Prune)
Со временем скапливается много "мусора" (остановленных контейнеров).
```bash
docker container prune  # Удалит ВСЕ остановленные контейнеры
```

## Автоматический перезапуск (Restart Policy)
Что делать, если приложение упало или сервер перезагрузился?

```bash
docker run -d --restart unless-stopped nginx
```

| Политика | Описание |
| :--- | :--- |
| `no` | Не перезапускать никогда (Default). |
| `on-failure` | Перезапускать, только если упал с ошибкой (код выхода != 0). |
| `always` | Всегда перезапускать. Если остановили руками (`stop`), перезапустит после рестарта демона Docker. |
| `unless-stopped` | Почти как `always`, но **не** запустится после рестарта демона, если был остановлен руками. **Рекомендуется для продакшена.** |

## Ограничение ресурсов (Limits)
По умолчанию контейнер может забрать **весь** CPU и RAM хоста, что может "повесить" сервер.

### При запуске (`docker run`)
```bash
docker run -d \
  --cpus="0.5" \
  --memory="512m" \
  --memory-swap="1g" \
  nginx
```
*   `--cpus="0.5"`: Гарантирует, что контейнер не займет более 50% *одного* ядра.
*   `--memory="512m"`: Жесткий лимит RAM. Если процесс попытается съесть больше, придет **OOM Killer** и убьет его.

### На лету (`docker update`)
Вы можете изменить лимиты работающего контейнера без перезагрузки:
```bash
docker update --cpus="1.0" --memory="1g" my-app
```
> **Нюанс:** Увеличение памяти на лету работает, уменьшение — может не сработать, если память уже занята.

## Полезные команды отладки

*   `docker logs -f my-app`: Читать логи в реальном времени (`-f` = follow).
*   `docker inspect my-app`: Показать всю мета-информацию (IP, пути к volumes, Env).
*   `docker stats`: Аналог `htop` для контейнеров (CPU/RAM usage в реальном времени).
*   `docker exec -it my-app bash`: Зайти внутрь контейнера (запустить bash). Если bash нет (Alpine), используйте `sh`.
