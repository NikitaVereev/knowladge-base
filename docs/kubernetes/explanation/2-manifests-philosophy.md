---
title: 2 Философия манифестов - Императивный vs Декларативный
type: explanation
tags: [kubernetes, manifests, yaml, kubectl, concepts]
---

В Kubernetes существуют два принципиально разных способа управления ресурсами. Понимание разницы между ними критично для перехода от "просто попробовать" к "production-ready" инженерии.

---

## 1. Императивный подход (Imperative)
**"Сделай это прямо сейчас."**

Вы даете конкретные команды глаголами действия: "создай", "запусти", "удали". Вы говорите системе *КАК* достичь результата шаг за шагом.

### Примеры
```bash
# Создай под с nginx
kubectl run nginx --image=nginx

# Создай деплоймент
kubectl create deployment web --image=nginx --replicas=3

# Обнови картинку
kubectl set image deployment/web nginx=nginx:1.19

# Удали всё
kubectl delete deployment web
```

### Плюсы и минусы
*   **[+] Скорость:** Идеально для быстрых тестов, обучения и отладки.
*   **[-] Нет истории:** Команды выполняются и забываются. Нельзя посмотреть `git log` и понять, кто и зачем изменил количество реплик неделю назад.
*   **[-] Сложность восстановления:** Если кластер упадет, вам придется вспоминать все команды, которые вы вводили, чтобы восстановить состояние.

---

## 2. Декларативный подход (Declarative)
**"Я хочу, чтобы было вот так."**

Вы описываете *Желаемое Состояние* (Desired State) в файле (Манифесте) и отдаете его Kubernetes. Кластер сам решает, какие действия нужно предпринять, чтобы текущее состояние соответствовало желаемому.

### Примеры
Вы создаете файл `web-deployment.yaml`:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - name: nginx
        image: nginx:1.19
```

И применяете его одной универсальной командой:
```bash
kubectl apply -f web-deployment.yaml
```

### Идемпотентность (Idempotency)
Это ключевое свойство декларативного подхода.
*   Если вы выполните `kubectl apply -f ...` **первый раз**, Kubernetes увидит, что деплоймента нет, и **создаст** его.
*   Если вы выполните ту же команду **второй раз**, Kubernetes проверит состояние, увидит, что оно совпадает с файлом, и **ничего не сделает**.
*   Если вы **измените** в файле `replicas: 3` на `replicas: 5` и выполните команду, Kubernetes вычислит разницу (diff) и **добавит** 2 пода.

### Плюсы и минусы
*   **[+] Infrastructure as Code (IaC):** Файлы хранятся в Git. Вы видите историю изменений, code review и можете откатиться назад.
*   **[+] Самодокументация:** YAML-файл — это и есть документация того, что крутится в кластере.
*   **[-] Многословие:** YAML-файлы могут быть громоздкими и сложными для написания с нуля (поэтому часто используют генерацию через `kubectl create ... --dry-run=client -o yaml`).

---

## Сравнение: Create vs Apply

| Характеристика | `kubectl create` | `kubectl apply` |
| :--- | :--- | :--- |
| **Тип** | Императивный | Декларативный |
| **Логика** | "Создай новый объект" | "Приведи к этому состоянию" |
| **Повторный запуск** | Ошибка (AlreadyExists) | Успех (обновление или без изменений) |
| **Использование** | Разовые задачи, тесты | CI/CD, Production, GitOps |

