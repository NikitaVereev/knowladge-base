---
title: "Настройка SSH ключей (Ed25519)"
description: "Генерация современных SSH ключей Ed25519, копирование на сервер и настройка ssh-agent для безпарольного входа."
---


Использование SSH ключей вместо паролей — это стандарт безопасности и удобства. Ключи необходимы для работы Ansible, автоматического деплоя и безопасного доступа к серверам.

## Зачем это нужно

- **Безопасность:** Ключ Ed25519 взломать практически невозможно, в отличие от пароля.
- **Автоматизация:** Скрипты и Ansible не умеют вводить пароли вручную.
- **Удобство:** Вход на сервер мгновенный.

## 1. Генерация ключа

Мы используем алгоритм **Ed25519** — это современный стандарт (быстрее и безопаснее старого RSA).

```bash
ssh-keygen -t ed25519 -C "your-email@example.com"
```

**Процесс:**
1. Нажмите `Enter`, чтобы сохранить в стандартный путь (`~/.ssh/id_ed25519`).
2. **Passphrase:** Для локальной разработки можно оставить пустым (нажмите `Enter` дважды). Для продакшена рекомендуется задать пароль на ключ.

В результате в папке `~/.ssh/` появятся два файла:
- `id_ed25519` — **Приватный ключ**. Храните в секрете, никому не передавайте.
- `id_ed25519.pub` — **Публичный ключ**. Его можно и нужно копировать на сервера.

## 2. Копирование ключа на сервер

Команда `ssh-copy-id` автоматически добавляет ваш публичный ключ в список доверенных (`~/.ssh/authorized_keys`) на удаленном сервере.

**Стандартный сервер (порт 22):**
```bash
ssh-copy-id username@remote-server-ip
```

**Виртуальная машина (нестандартный порт, например 2222):**
```bash
# Флаг -p указывает порт
ssh-copy-id -p 2222 username@127.0.0.1
```
*Если команды `ssh-copy-id` нет (например, на Windows), скопируйте содержимое `.pub` файла вручную в файл `~/.ssh/authorized_keys` на сервере.*

## 3. Проверка входа

Попробуйте подключиться. Пароль запрашиваться не должен.

```bash
ssh username@127.0.0.1 -p 2222
```

## 4. Настройка SSH Agent

Если вы задали пароль (passphrase) для ключа, вам придется вводить его при каждом подключении. Чтобы вводить его один раз за сессию, используйте `ssh-agent`.

**Запуск агента (для текущей сессии):**
```bash
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_ed25519
```

**Проверка добавленных ключей:**
```bash
ssh-add -l
```

## Устранение неполадок

Если вход по ключу не работает, часто проблема в правах доступа к файлам (SSH очень строг к этому).

**На локальной машине:**
```bash
# Приватный ключ должен быть доступен только владельцу
chmod 600 ~/.ssh/id_ed25519
chmod 644 ~/.ssh/id_ed25519.pub
```

**На сервере:**
```bash
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

## Связанные материалы

- [[create-vm-manually|Ручное создание VM с SSH]]
- [[devops/ansible/tutorials/setup-environment|Подготовка окружения для Ansible]]
