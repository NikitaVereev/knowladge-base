---
title: "7 Асинхронные задачи в Ansible"
description: "Запуск долгих операций с async/poll, режим fire-and-forget и ожидание событий."
---

По умолчанию Ansible ждет завершения каждой задачи перед переходом к следующей. Это не всегда удобно для долгих операций (обновление системы, скачивание больших файлов) или когда SSH-сессия может оборваться.

## Async и Poll

Параметры, управляющие временем выполнения:
*   `async`: Максимальное время в секундах, которое задача может работать (таймаут).
*   `poll`: Как часто (в секундах) проверять статус задачи.

### Пример 1: Долгое выполнение с ожиданием
Ansible запустит задачу, закроет SSH, и будет переподключаться каждые 60 секунд для проверки статуса.
```yaml
- name: Upgrade system packages
  apt: upgrade=dist update_cache=yes
  async: 3600      # Ждать до 1 часа
  poll: 60         # Проверять раз в минуту
```

### Пример 2: Fire-and-Forget (Запустить и забыть)
Если установить `poll: 0`, Ansible запустит задачу и **сразу** перейдет к следующей, не дожидаясь результата. Полезно для фоновых скриптов или перезагрузки.
```yaml
- name: Run heavy background script
  command: /opt/scripts/heavy_job.sh
  async: 3600
  poll: 0
```

## Ожидание событий (`wait_for`)
Модуль `wait_for` позволяет приостановить выполнение до наступления события (например, порт открылся после ребута).

```yaml
- name: Wait for SSH to come back
  wait_for:
    host: "{{ inventory_hostname }}"
    port: 22
    delay: 10
    timeout: 300
    search_regex: OpenSSH
  delegate_to: localhost
```
