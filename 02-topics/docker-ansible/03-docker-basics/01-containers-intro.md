### Docker контейнеры: введение

Архитектура Docker и как контейнеры работают.

---

#### Что такое Docker

**Определение:**
- Платформа для разработки, доставки и запуска приложений в контейнерах
- Контейнеры — стандартные исполняемые пакеты с приложением и всеми зависимостями

---

#### Контейнеры vs Виртуальные машины

| | Контейнер | Виртуальная машина |
|---|-----------|------------------|
| ОС | Использует хостовую ОС | Полная гостевая ОС |
| Размер | ~10-100 МБ | ~1-10 ГБ |
| Время старта | ~100 мс | ~10 сек |
| Производительность | Близка к нативу | Накладные расходы |
| Изоляция | Процессы/ресурсы | Полная изоляция |

**Результат:** Контейнеры легче, быстрее, но меньше изолированы.

---

#### Как Docker работает на Linux

Docker использует функции ядра Linux для изоляции приложений:

**cgroups (control groups)**
- Ограничение ресурсов (CPU, RAM, диск, I/O)
- Приоритизация процессов
- Каждый контейнер имеет свои лимиты

**namespaces**
- **PID namespace** — изолированная иерархия процессов
- **Network namespace** — собственная сеть и порты
- **Mount namespace** — собственная файловая система
- **UTS namespace** — собственный hostname
- **IPC namespace** — изолированные сообщения между процессами

**chroot и Union FS**
- chroot меняет корневую директорию для процесса
- Union FS позволяет многоуровневую файловую систему (layers)

---

#### Процессы в Linux и их изоляция

**Создание процессов:**
```bash
fork()      # создание дочернего процесса
execv()     # замена образа процесса новой программой
```

**Изоляция в контейнере:**
- Каждый контейнер имеет собственное пространство имён
- Процессы не видят друг друга через `/proc`
- Ресурсы ограничены через cgroups
- Отделённая файловая система через chroot

---

## Компоненты Docker

**Docker Engine**
- Основной компонент, демон `dockerd`
- Создает и управляет контейнерами на хостовой машине
- REST API для управления
- Работает в фоне на машине

**Docker CLI**
- Командная строка `docker`
- Клиент для взаимодействия с Docker Engine через REST API
- Команды: run, stop, logs, exec, и т.д.

**Docker Images**
- Шаблоны только для чтения
- Слои образа (Dockerfile layers)
- Registry (Docker Hub, private registries)
- Можешь скачать готовый образ или создать свой

**Docker Containers**
- Запущенные экземпляры образов
- Writable layer поверх read-only образа
- Изолированы: процессы, файловая система, сеть, пользователи
- Stateful — состояние сохраняется

**Docker Objects:**
- **Networks** — сети между контейнерами
- **Volumes** — хранилище для данных
- **Configs, Secrets** — чувствительные данные

---

#### Архитектура Docker

```
┌─────────────────┐
│  Docker CLI     │
│  (docker cmd)   │
└────────┬────────┘
         │
      REST API
         │
┌────────▼────────┐
│ Docker Daemon   │
│   (dockerd)     │
└────────┬────────┐
         │        
    ┌────┴────┬──────────┬──────────┐
    │          │          │          │
 Images   Containers   Networks  Volumes
```

---

#### Преимущества Docker

**Быстрая доставка приложений**
- Легковесность контейнеров (~100 МБ vs 1-10 ГБ для VM)
- Портативность между машинами
- "Работает на моей машине" = работает везде

**Высокая производительность**
- Меньше накладных расходов чем VM
- Быстрый старт контейнеров (~100 мс)
- Низкое потребление памяти и CPU

**Изоляция зависимостей**
- Приложение А использует Python 3.8, B использует 3.11
- Конфликтов не будет, каждый в своем контейнере
- Системные библиотеки изолированы

**Простое масштабирование**
- Запустить 100 копий приложения в разные контейнеры
- Load balancer распределит нагрузку
- Управление кластером контейнеров просто

---

#### Жизненный цикл контейнера

```
          ┌─────────────┐
          │   Created   │
          └──────┬──────┘
                 │
            docker start
                 │
    ┌────────────▼──────────────┐
    │                           │
docker pause                docker stop
    │                           │
┌───▼──────┐            ┌───────▼────┐
│  Paused   │            │   Stopped  │
└───┬──────┘            └────┬───────┘
    │                         │
docker unpause          docker start
    │                         │
    └────────────┬────────────┘
                 │
           ┌─────▼─────┐
           │  Running   │
           └─────┬─────┘
                 │
            docker rm
                 │
            Removed
```

---

#### Быстрый старт

**Запустить простой контейнер:**
```bash
docker run --name myapp -d nginx:latest
```

**Проверить статус:**
```bash
docker ps
```

**Остановить:**
```bash
docker stop myapp
```

**Удалить:**
```bash
docker rm myapp
```

---
